---
title: "BDA505_Group_Project"
output: html_document
---

```{r setup, include=FALSE}
library(RSQLite)
library(sqldf)
library(lubridate)
library(dplyr)
library(ggplot2)
library(scales)
```

## New York Taxi Data Set

DATANIN NASIL ALINDIÐI YAZILACAK
DATA ÇAIKLAMALARI DÜZENLENECEK

This data is downloaded from XXX. The purpose of the study is to analyze picking up and dropping of passenger times.

The data includes xxx trips. Explanation of the attributes of data is given below.

```{r message=FALSE, results='hide' }
df <- read.csv("C:/Users/OF2646/Desktop/BDM Proje/trips-2018-02.csv")

#vendor_id : a code indicating the provider associated with the trip record
#passenger_count : the number of passengers in the vehicle (driver entered value)
#pickup_longitude : date and time when the meter was engaged
#pickup_latitude : date and time when the meter was disengaged
#dropoff_longitude : the longitude where the meter was disengaged
#dropoff_latitude : the latitude where the meter was disengaged
#trip_duration : (target) duration of the trip in seconds
```

## Data Manipulation


```{r message=FALSE, results='hide' }
#take the columns we analyze.
df2 <- sqldf("SELECT VendorID,lpep_pickup_datetime,lpep_dropoff_datetime,PULocationID,
                       DOLocationID,passenger_count,trip_distance,total_amount,payment_type FROM df")

summary(df2)

#two new columns for hours. Convert date.

df2$lpep_pickup_hour <- format(as.POSIXct(df2$lpep_pickup_datetime) ,format = "%H:%M:%S")
df2$lpep_dropoff_hour <- format(as.POSIXct(df2$lpep_dropoff_datetime) ,format = "%H:%M:%S")

head(df2)

df2$lpep_pickup_datetime <- format(as.POSIXct(df2$lpep_pickup_datetime) ,format = "%Y/%m/%d %H-%M-%S")

df2$lpep_pickup_datetime <- as.Date(df2$lpep_pickup_datetime)

df2$lpep_dropff_datetime <- format(as.POSIXct(df2$lpep_dropoff_datetime) ,format = "%Y/%m/%d %H-%M-%S")

df2$lpep_dropoff_datetime <- as.Date(df2$lpep_dropoff_datetime)
```

## Distribution of Passenger Count

```{r message=FALSE, echo=FALSE }
#plot for distribution of passenger count.It can be seen from the graph below, mostly 
#1 or 2 people chose to travel by cab. Usage of more the 2 people is very rare in the dataset.
#Choose trips has passenger more than 0.
pass_count <- sqldf("SELECT count(VendorID) as total,passenger_count FROM df
                    WHERE passenger_count!=0
                    GROUP BY passenger_count")


plot1 <- ggplot(pass_count, aes(x=passenger_count,y=total)) + 
  geom_bar(position="dodge", stat="identity") +
  scale_y_continuous(labels = comma)+
  labs(subtitle="Passenger Count", title= "NewYork Taxi",
       caption="(based on data from XXX)", y="Count", x="Passenger Count")
plot1
```

## Distribution of Pick-Ups by Daytime. 

```{r message=FALSE, echo=FALSE }
#categorize trips according to pickup time.
pickup_time_df <- sqldf("SELECT count(VendorID)as total,
  CASE
      WHEN lpep_pickup_hour between '00:00:00' and '05:00:00' then 'late-night'
      WHEN lpep_pickup_hour between '05:00:01' and '12:00:00' then 'morning'
      WHEN lpep_pickup_hour between '12:00:01' and '18:00:00' then 'midday'
      WHEN lpep_pickup_hour between '18:00:01' and '23:59:59' then 'night'
      ELSE 0
      END pickup_time
      FROM df2
      GROUP BY pickup_time")


plot2 <- ggplot(pickup_time_df, aes(x=pickup_time,y=total)) + 
  geom_bar(position="dodge", stat="identity") +
  scale_y_continuous(labels = comma)+
  labs(subtitle="Trips for Pick Up Time", title= "NewYork Taxi",
       caption="(based on data from XXX)", y="Count", x="Day Time")
plot2
```

## Distribution of Drop-offs by Daytime. 

```{r message=FALSE, echo=FALSE }
#categorize trips according to dropff time.
dropoff_time_df <- sqldf("SELECT count(VendorID)as total,
  CASE
      WHEN lpep_dropoff_hour between '00:00:00' and '05:00:00' then 'late-night'
      WHEN lpep_dropoff_hour between '05:00:01' and '12:00:00' then 'morning'
      WHEN lpep_dropoff_hour between '12:00:01' and '18:00:00' then 'midday'
      WHEN lpep_dropoff_hour between '18:00:01' and '23:59:59' then 'night'
      ELSE 0
      END dropoff_time
      FROM df2
      GROUP BY dropoff_time")


plot3 <- ggplot(dropoff_time_df, aes(x=dropoff_time,y=total)) + 
  geom_bar(position="dodge", stat="identity") +
  scale_y_continuous(labels = comma)+
  labs(subtitle="Trips for Drop Off Time", title= "NewYork Taxi",
       caption="(based on data from XXX)", y="Count", x="Day Time")
plot3
```







